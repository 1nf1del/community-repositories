machine:
  services:
    - docker
  environment:
    CHECK_BUILD_DIFFS: false
    GENMETADATA_PHASE: false
    CLEAN_PHASE: false
    DEPLOY_PHASE: false
    DOCKERHUB_PUSH: 1
dependencies:
  override:
    - docker pull sabayon/builder-amd64
test:
  override:
    - git clone https://github.com/Sabayon/devkit.git devkit
    - git clone https://github.com/Sabayon/community-buildspec.git buildspec
    - sudo ./test_ci.sh $CIRCLE_COMPARE_URL
  post:
    - [ -d "buildspec/artifacts" ] && cp -Rfv buildspec/artifacts $CIRCLE_ARTIFACTS
    - [ -d "buildspec/logs" ] && cp -Rfv buildspec/logs $CIRCLE_ARTIFACTS
